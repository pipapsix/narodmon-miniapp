<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Narodmon Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {font-family: sans-serif; padding:20px; background:#000; color:#fff; margin:0;}
    button {padding:14px 24px; font-size:16px; border-radius:12px; border:none; background:#0088cc; color:white;}
    pre {background:#111; padding:15px; border-radius:8px; overflow:auto; max-height:70vh;}
  </style>
</head>
<body>
  <h1>–î–∞—Ç—á–∏–∫–∏ —Ä—è–¥–æ–º (–ú–æ—Å–∫–≤–∞)</h1>
  <button onclick="load()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
  <pre id="out">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ‚Üë</pre>

  <script>
async function load() {
  document.getElementById('out').innerHTML = '–ó–∞–≥—Ä—É–∂–∞—é –ø—Ä–∏–º–µ—Ä—ã –¥–∞—Ç—á–∏–∫–æ–≤ –ú–æ—Å–∫–≤—ã‚Ä¶';

  // –§–µ–π–∫–æ–≤—ã–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ç–∞–Ω—Ü–∏–π –ù–∞—Ä–æ–¥–º–æ–Ω–∞ –≤ –¥–µ–∫–∞–±—Ä–µ 2025)
  const exampleDevices = [
    {
      name: "–ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ",
      lat: 55.734, lng: 37.609, distance: 2.1,
      sensors: [
        { type: 1, value: -1.2 }, // —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
        { type: 2, value: 82 },   // –≤–ª–∞–∂–Ω–æ—Å—Ç—å
        { type: 3, value: 748 }   // –¥–∞–≤–ª–µ–Ω–∏–µ
      ],
      time: Date.now() / 1000
    },
    {
      name: "–í–î–ù–•",
      lat: 55.823, lng: 37.620, distance: 8.5,
      sensors: [
        { type: 1, value: -2.8 },
        { type: 2, value: 88 },
        { type: 3, value: 752 }
      ],
      time: Date.now() / 1000
    },
    {
      name: "–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å",
      lat: 55.753, lng: 37.623, distance: 0.3,
      sensors: [
        { type: 1, value: -0.5 },
        { type: 2, value: 79 },
        { type: 3, value: 749 }
      ],
      time: Date.now() / 1000
    },
    {
      name: "–ü–∞—Ä–∫ –ö–æ–ª–æ–º–µ–Ω—Å–∫–æ–µ",
      lat: 55.674, lng: 37.686, distance: 9.2,
      sensors: [
        { type: 1, value: -3.1 },
        { type: 2, value: 91 },
        { type: 3, value: 747 }
      ],
      time: Date.now() / 1000
    },
    {
      name: "–û—Å—Ç–∞–Ω–∫–∏–Ω–æ",
      lat: 55.819, lng: 37.611, distance: 7.9,
      sensors: [
        { type: 1, value: -1.8 },
        { type: 2, value: 85 },
        { type: 3, value: 750 }
      ],
      time: Date.now() / 1000
    }
    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  ];

  // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
  await new Promise(resolve => setTimeout(resolve, 1000));

  const nearby = exampleDevices.sort((a, b) => a.distance - b.distance);

  let html = `<b>–ü—Ä–∏–º–µ—Ä—ã –¥–∞—Ç—á–∏–∫–æ–≤ –≤ —Ä–∞–¥–∏—É—Å–µ 10 –∫–º –æ—Ç –ú–æ—Å–∫–≤—ã (5 —Å—Ç–∞–Ω—Ü–∏–π)</b><br><br>`;
  
  nearby.forEach(d => {
    const temp = d.sensors.find(s => s.type === 1)?.value ?? '‚Äî';
    const hum = d.sensors.find(s => s.type === 2)?.value ?? '‚Äî';
    const press = d.sensors.find(s => s.type === 3)?.value ?? '‚Äî';
    
    html += `<b>${d.name}</b> ‚Äî ${d.distance} –∫–º<br>`;
    html += `üå°Ô∏è ${temp}¬∞C‚ÄÉüíß ${hum}%‚ÄÉüìä ${press} –º–º.—Ä—Ç.—Å—Ç.<br>`;
    html += `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date(d.time * 1000).toLocaleTimeString('ru-RU')}<br><br>`;
  });

  document.getElementById('out').innerHTML = html;
}

Telegram.WebApp.ready();
Telegram.WebApp.MainButton.setText('–û–±–Ω–æ–≤–∏—Ç—å').onClick(load).show();

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ–±—ã—á–Ω–æ–π –∫–Ω–æ–ø–∫–∏ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.querySelector('button[onclick="load()"]');
  if (btn) {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      load();
    });
  }
});

// –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
load();
</script>
</body>
</html>
